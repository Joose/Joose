var joosetop=this;Joose=function(){this.top=joosetop;this.anonymouseClassCounter=0};Joose.A={};Joose.A.each=function(C,B){for(var A=0;A<C.length;A++){B(C[A],A)}};Joose.A.exists=function(C,B){for(var A=0;A<C.length;A++){if(C[A]==B){return true}}return false};Joose.A.concat=function(A,B){A.push.apply(A,B);return A};Joose.A.grep=function(C,B){var A=[];Joose.A.each(C,function(D){if(B(D)){A.push(D)}});return A};Joose.A.remove=function(C,B){var A=[];Joose.A.each(C,function(D){if(D!==B){A.push(D)}});return A};Joose.S={};Joose.S.uppercaseFirst=function(A){var C=A.substr(0,1);var B=A.substr(1,A.length-1);C=C.toUpperCase();return C+B};Joose.S.isString=function(A){if(typeof A=="string"){return true}return false};Joose.O={};Joose.O.each=function(A,C){for(var B in A){C(A[B],B)}};Joose.O.eachSafe=function(A,E,C){var D=false;for(var B in A){if(A.hasOwnProperty(B)){if(B=="toString"){D=true}E.call(C||this,A[B],B)}}if(!D&&A.hasOwnProperty("toString")){E.call(C||this,A.toString,"toString")}};Joose.O.extend=function(D,C){for(var B in C){var A=C[B];D[B]=A}};Joose.F={};Joose.F.createDelegate=function(C,B,D,A){return function(){var E;if(A){E=Array.prototype.slice(arguments).concat(D)}else{E=D}C.apply(B||joose.top,E)}};Joose.prototype={addToString:function(A,B){A.toString=B},isInstance:function(A){if(!A.meta){throw"isInstance only works with Joose objects and classes."}return A.constructor===A.meta.nextGeneration},init:function(){this.builder=new Joose.Builder();this.builder.globalize()},components:function(){return["Joose.Kernel.ProtoMeta","Joose.Kernel.ClassSeparation","Joose.Kernel.ProtoMethod","Joose.Kernel.ProtoAttribute","Joose.Kernel.Inheritance","Joose.Kernel.ProtoClassMethod","Joose.Kernel.ClassMethods","Joose.Kernel.Handlers","Joose.Kernel.AdvancedProtoAttribute","Joose.Kernel.Namespace","Joose.Kernel.DependenciesGroup","Joose.Kernel.NamespaceKeeper","Joose.Kernel.ProtoModule","Joose.Kernel.Roles","Joose.Kernel.ProtoRole","Joose.Kernel.MetaClass","Joose.TypeConstraint","Joose.Attribute","Joose.Method","Joose.ClassMethod","Joose.Class","Joose.Builder","Joose.TypeCoercion","Joose.Types","Joose.Role","Joose.SimpleRequest","Joose.Gears","Joose.Storage","Joose.Storage.Unpacker","Joose.Decorator","Joose.Prototype","Digest.MD5"]},loadComponents:function(B){var A="";Joose.A.each(this.components(),function(D){var C=""+B+"/"+D.split(".").join("/")+".js";A+='<script type="text/javascript" src="'+C+'"><\/script>'});document.write(A)}};Joose.copyObject=function(B,C){var A="";Joose.O.each(B,function(E,D){A+=", "+D;C[D]=E});return C};Joose.emptyFunction=function(){};this.joose=new Joose();Joose.Kernel=Joose.Kernel||function(){throw new Error("Modules may not be instantiated.")};Joose.Kernel.ProtoMeta=function(){this.initialize.apply(this,arguments)};Joose.Kernel.ProtoMeta.prototype={_name:"Joose.Kernel.ProtoMeta",attributes:{},methods:{},constructor:Joose.Kernel.ProtoMeta,meta:Joose.Kernel.ProtoMeta,nextGeneration:null,initialize:function(A){if(!A){throw ("MetaClass cant be instantiated without nextGeneration")}this.nextGeneration=A;var B=this.constructor.prototype;Joose.O.eachSafe(B,function(D,C){if(C!="constructor"&&C!="meta"){if(typeof B[C]=="function"){this.addMethod(C,B[C])}else{this.addAttribute(C,B[C])}}},this)},addMethod:function(A,B){if(typeof B!="function"){throw"Trying to add something else but not method"}this.methods[A]=B;this.nextGeneration.prototype[A]=B},addAttribute:function(A,B){this.attributes[A]=B;this.nextGeneration.prototype[A]=B},hasMethod:function(A){return this.methods.hasOwnProperty(A)},hasAttribute:function(A){return this.attributes.hasOwnProperty(A)},className:function(){return this._name},getName:function(){return this.className()},toString:function(){if(this.meta){return"a "+this.meta.className()}return"NoMeta"}};Joose.Kernel.ProtoMeta=new Joose.Kernel.ProtoMeta(Joose.Kernel.ProtoMeta);Joose.Kernel.ProtoMeta.meta=Joose.Kernel.ProtoMeta;Joose.Kernel.ProtoMeta.constructor.meta=Joose.Kernel.ProtoMeta;Joose.Kernel.ProtoMeta.constructor.prototype.meta=Joose.Kernel.ProtoMeta;Joose.Kernel.ProtoMeta=Joose.Kernel.ProtoMeta.constructor;Joose.Kernel.ProtoMeta.meta.addMethod("addGenes",function(A){Joose.O.eachSafe(A,function(B,C){if(C!="meta"&&C!="constructor"){typeof A[C]=="function"?this.addMethod(C,A[C]):this.addAttribute(C,A[C])}},this)});Joose.Kernel.ProtoMeta.meta.addGenes({adoptNextGeneration:function(){var A=this.nextGeneration;A.prototype.constructor=A;A.prototype.meta=this;A.meta=this;if(!A.hasOwnProperty("toString")){A.toString=function(){return this.meta.className()}}return A},getClassObject:function(){return this.nextGeneration},dieIfString:function(A){if(Joose.S.isString(A)){throw new TypeError("Parameter must not be a string.")}},classIsa:function(A){this.dieIfString(A);return this.nextGeneration==A}});Joose.Kernel=Joose.Kernel||function(){throw new Error("Modules may not be instantiated.")};Joose.Kernel.ProtoMeta=function(){this.initialize.apply(this,arguments)};Joose.Kernel.ProtoMeta.prototype={_name:"Joose.Kernel.ProtoMeta",attributes:{},methods:{},constructor:Joose.Kernel.ProtoMeta,meta:Joose.Kernel.ProtoMeta,nextGeneration:null,initialize:function(A){if(!A){throw ("MetaClass cant be instantiated without nextGeneration")}this.nextGeneration=A;var B=this.constructor.prototype;Joose.O.eachSafe(B,function(D,C){if(C!="constructor"&&C!="meta"){if(typeof B[C]=="function"){this.addMethod(C,B[C])}else{this.addAttribute(C,B[C])}}},this)},addMethod:function(A,B){if(typeof B!="function"){throw"Trying to add something else but not method"}this.methods[A]=B;this.nextGeneration.prototype[A]=B},addAttribute:function(A,B){this.attributes[A]=B;this.nextGeneration.prototype[A]=B},hasMethod:function(A){return this.methods.hasOwnProperty(A)},hasAttribute:function(A){return this.attributes.hasOwnProperty(A)},className:function(){return this._name},getName:function(){return this.className()},toString:function(){if(this.meta){return"a "+this.meta.className()}return"NoMeta"}};Joose.Kernel.ProtoMeta=new Joose.Kernel.ProtoMeta(Joose.Kernel.ProtoMeta);Joose.Kernel.ProtoMeta.meta=Joose.Kernel.ProtoMeta;Joose.Kernel.ProtoMeta.constructor.meta=Joose.Kernel.ProtoMeta;Joose.Kernel.ProtoMeta.constructor.prototype.meta=Joose.Kernel.ProtoMeta;Joose.Kernel.ProtoMeta=Joose.Kernel.ProtoMeta.constructor;Joose.Kernel.ProtoMeta.meta.addMethod("addGenes",function(A){Joose.O.eachSafe(A,function(B,C){if(C!="meta"&&C!="constructor"){typeof A[C]=="function"?this.addMethod(C,A[C]):this.addAttribute(C,A[C])}},this)});Joose.Kernel.ProtoMeta.meta.addGenes({adoptNextGeneration:function(){var A=this.nextGeneration;A.prototype.constructor=A;A.prototype.meta=this;A.meta=this;if(!A.hasOwnProperty("toString")){A.toString=function(){return this.meta.className()}}return A},getClassObject:function(){return this.nextGeneration},dieIfString:function(A){if(Joose.S.isString(A)){throw new TypeError("Parameter must not be a string.")}},classIsa:function(A){this.dieIfString(A);return this.nextGeneration==A}});var classSeparationMeta=new Joose.Kernel.ProtoMeta(function(B,A){this.initialize.apply(this,arguments);this.meta.initialize.call(this,this.nextGeneration)});classSeparationMeta.addGenes({parentClasses:null,initialize:function(B,A){this.parentClasses=[];this.attributes={},this.methods={};this._name=B||"__anonymous__";this.nextGeneration=A||this.defaultClassFunctionBody();this.adoptNextGeneration()},defaultClassFunctionBody:function(){return function(){this.initialize.apply(this,arguments)}},classIsa:function(B){this.dieIfString(B);if(this.nextGeneration==B){return true}for(var A=0;A<this.parentClasses.length;A++){if(this.parentClasses[A].meta.classIsa(B)){return true}}return false},isa:function(A){this.dieIfString(A);return this.classIsa(A)},instantiate:function(){var A=function(){};A.prototype=this.nextGeneration.prototype;var B=new A();this.nextGeneration.apply(B,arguments);return B},getAttributes:function(){return this.attributes},getAttribute:function(A){return this.attributes.hasOwnProperty(A)?this.attributes[A]:undefined},getMethodObject:function(A){return this.methods.hasOwnProperty(A)?this.methods[A]:undefined},getMethodNames:function(){var A=[];Joose.O.eachSafe(this.methods,function(C,B){A.push(B)});return A},getAttributeNames:function(){var A=[];Joose.O.eachSafe(this.attributes,function(C,B){A.push(B)});return A},getSuperClasses:function(){return this.parentClasses},getSuperClass:function(){return this.parentClasses[0]},classNameToClassObject:function(D){var F=joose.top;var E=D.split(".");var B=F;for(var C=0;C<E.length;C++){var A=E[C];B=B[A];if(!B){throw"Unable to find class "+D}}return B}});classSeparationMeta.adoptNextGeneration();classSeparationMeta._name="Joose.Kernel.ClassSeparation";Joose.Kernel.ClassSeparation=classSeparationMeta.getClassObject();var protoMethodMeta=new Joose.Kernel.ClassSeparation("Joose.Kernel.ProtoMethod",function(A,B){this.initialize(A,B)});protoMethodMeta.addGenes({_name:null,_body:null,_isFromSuperClass:false,getName:function(){return this._name},getBody:function(){return this._body},isFromSuperClass:function(){return this._isFromSuperClass},setIsFromSuperClass:function(A){this._isFromSuperClass=A},copy:function(A){return new A(this.getName(),this.getBody())},initialize:function(A,B){this._name=A;this._body=B;B.name=A},apply:function(A,B){return this._body.apply(A,B)},addToClass:function(A){A.meta.methods[this.getName()]=this;A.prototype[this.getName()]=this.asFunction()},asFunction:function(){return this._body},_makeWrapped:function(A){return new this.constructor(this.getName(),A)},around:function(A){var C=this.getBody();return this._makeWrapped(function B(){var E=this;var D=function(){return C.apply(E,arguments)};return A.apply(this,Joose.A.concat([D],arguments))})},before:function(B){var C=this.getBody();return this._makeWrapped(function A(){B.apply(this,arguments);return C.apply(this,arguments)})},after:function(B){var C=this.getBody();return this._makeWrapped(function A(){var D=C.apply(this,arguments);B.apply(this,arguments);return D})},override:function(B){var C=this.getBody();return this._makeWrapped(function A(){var F=this;var E=function(){return C.apply(F,arguments)};var G=this.SUPER;this.SUPER=E;var D=B.apply(this,arguments);this.SUPER=G;return D})},augment:function(B){var C=this.getBody();return this._makeWrapped(function A(){var H=C;var F=this;var D=B;if(!this.__INNER_STACK__){this.__INNER_STACK__=[]}this.__INNER_STACK__.push(D);var G=this.INNER;this.INNER=function(){return F.__INNER_STACK__.pop().apply(F,arguments)};var E=C.apply(this,arguments);this.INNER=G;return E})}});Joose.Kernel.ProtoMethod=protoMethodMeta.getClassObject();var protoAttributeMeta=new Joose.Kernel.ClassSeparation("Joose.Kernel.ProtoAttribute",function(A,B){this.initialize(A,B)});protoAttributeMeta.addGenes({_name:null,_props:null,getName:function(){return this._name},getProps:function(){return this._props},initialize:function(A,B){this._name=A;this._props=B||{}},isPrivate:function(){return this.getName().charAt(0)=="_"},copy:function(A){return new A(this.getName(),this.getProps())},toPublicName:function(){if(this.__publicNameCache){return this.__publicNameCache}var A=this.getName();if(this.isPrivate()){this.__publicNameCache=A.substr(1);return this.__publicNameCache}this.__publicNameCache=A;return this.__publicNameCache},handleInit:function(C){var B=this.getProps();var A=this.getName();C.prototype[A]=null;if(typeof B.init!="undefined"){C.prototype[A]=B.init}},handleProps:function(A){this.handleInit(A)},addToClass:function(A){A.meta.attributes[this.getName()]=this;this.handleProps(A)},doInitialization:function(B,A){}});Joose.Kernel.ProtoAttribute=protoAttributeMeta.getClassObject();var inheritanceMeta=new Joose.Kernel.ClassSeparation("Joose.Kernel.Inheritance");inheritanceMeta.addAttribute("methodConstructor",Joose.Kernel.ProtoMethod);inheritanceMeta.addAttribute("attributeConstructor",Joose.Kernel.ProtoAttribute);inheritanceMeta.addGenes({addSuperClass:function(E){this.dieIfString(E);if(!E.meta.meta.hasMethod("isa")||!E.meta.meta.hasMethod("getMethodObject")){throw"Class "+E+"can't be used as parent class"}var D=this;var F=E.meta.getMethodNames();for(var C=0;C<F.length;C++){var B=F[C];var A=E.meta.getMethodObject(B);if(typeof A=="function"){A=new this.methodConstructor(B,A)}if(A){var G=A.copy(this.methodConstructor);G.setIsFromSuperClass(true);D.addMethodObject(G)}}Joose.O.eachSafe(E.meta.attributes,function(J,I){var H=J;if(!(J&&J.meta&&J.constructor==J.meta.nextGeneration)){H=new D.attributeConstructor(I,{init:I=="attributes"?null:H,lazy:true})}else{H=H.copy(D.attributeConstructor)}D.addAttributeObject(H)});this.parentClasses.unshift(E)},addMethod:function(B,C){var A=new this.methodConstructor(B,C);this.addMethodObject(A)},addMethodObject:function(A){A.addToClass(this.nextGeneration)},attributeMetaclass:function(){return this.attributeConstructor},addAttribute:function(B,C){var A=new this.attributeConstructor(B,{init:C});this.addAttributeObject(A)},addAttributeObject:function(A){A.addToClass(this.nextGeneration)},setAttribute:function(A,B){return this.attributes[A]=B},wrapMethod:function(B,D,C,A){var E=this.getMethodObject(B);if(E){this.addMethodObject(E[D](C))}else{if(A){A()}else{throw new Error("Unable to apply "+D+" method modifier because method "+B+" does not exist")}}},makeAnonSubclass:function(){var A=new this.constructor(this.className()+"__anon__"+joose.anonymouseClassCounter++);A.addSuperClass(this.getClassObject());return A.getClassObject()},dispatch:function(A){return this.getMethodObject(A).asFunction()}});inheritanceMeta.parentClasses.unshift(Joose.Kernel.ClassSeparation);Joose.Kernel.Inheritance=inheritanceMeta.getClassObject();var protoClassMethodMeta=new Joose.Kernel.Inheritance("Joose.Kernel.ProtoClassMethod");protoClassMethodMeta.addSuperClass(Joose.Kernel.ProtoMethod);protoClassMethodMeta.addGenes({addToClass:function(A){A.meta.classMethods[this.getName()]=this;A[this.getName()]=this.asFunction()}});Joose.Kernel.ProtoClassMethod=protoClassMethodMeta.getClassObject();var classMethodsMeta=new Joose.Kernel.Inheritance("Joose.Kernel.ClassMethods");classMethodsMeta.addSuperClass(Joose.Kernel.Inheritance);classMethodsMeta.addAttribute("classMethods",null);classMethodsMeta.addAttribute("classMethodMetaClass",Joose.Kernel.ProtoClassMethod);classMethodsMeta.wrapMethod("initialize","after",function(){this.classMethods={}});classMethodsMeta.wrapMethod("addSuperClass","after",function(B){if(B.meta.meta.hasMethod("getClassMethodNames")){var C=B.meta.getClassMethodNames();for(var A=0;A<C.length;A++){var D=B.meta.getClassMethodObject(C[A]).copy(this.classMethodMetaClass);D.setIsFromSuperClass(true);this.addMethodObject(D)}}});classMethodsMeta.addGenes({hasMethod:function(A){return this.methods.hasOwnProperty(A)||this.classMethods.hasOwnProperty(A)},getClassMethodNames:function(){var A=[];Joose.O.eachSafe(this.classMethods,function(C,B){A.push(B)});return A},addAttribute:function(B,C){var A=new ((C&&C.metaclass)||this.attributeConstructor)(B,C);this.addAttributeObject(A)},addClassMethod:function(B,C){var A=new this.classMethodMetaClass(B,C);this.addMethodObject(A)},getClassMethodObject:function(A){return this.classMethods.hasOwnProperty(A)?this.classMethods[A]:undefined},getInstanceMethods:function(){var A=[];Joose.O.eachSafe(this.methods,function(B){A.push(B)});return A},getClassMethods:function(){var A=[];Joose.O.eachSafe(this.classMethods,function(B){A.push(B)});return A},can:function(A){return this.methods.hasOwnProperty(A)},classCan:function(A){return this.classMethods.hasOwnProperty(A)}});Joose.Kernel.ClassMethods=classMethodsMeta.getClassObject();var handlersMeta=new Joose.Kernel.ClassMethods("Joose.Kernel.Handlers");handlersMeta.addSuperClass(Joose.Kernel.ClassMethods);handlersMeta.addClassMethod("isa",function(A){return this.meta.classIsa(A)});handlersMeta.wrapMethod("adoptNextGeneration","after",function(){this.addToString();this.addInitializer()});handlersMeta.addGenes({isAbstract:{init:false},buildComplete:function(){},initializeFromProps:function(A){this._initializeFromProps(A)},_initializeFromProps:function(A){var B=this;if(A){if(joose.top.CHAOTIC_TRAVERSION_ORDER){Joose.A.each(["isa","does","has","method","methods"],function(C){if(C in A){var D=A[C];B._initializeFromProp(C,D,A);delete A[C]}})}Joose.O.eachSafe(A,function(D,C){B._initializeFromProp(C,D,A)});B.buildComplete()}},_initializeFromProp:function(E,D,C){var B=D;var A="handleProp"+E;if(this.meta.can(A)){this[A](B,C)}else{throw new Error("Called invalid builder "+E+" while creating class "+this.className())}},addToString:function(){this.addMethod("toString",function(){if(this.stringify){return this.stringify()}return"a "+this.meta.className()})},addInitializer:function(){if(!this.nextGeneration.prototype.initialize){this.addMethod("initialize",this.initializer())}},initializer:function(){return function A(E){if(this.meta.isAbstract){var D=this.meta.className();throw""+D+" is an abstract class and may not instantiated."}var C=this.meta.getAttributes();for(var F in C){if(C.hasOwnProperty(F)){var B=C[F];B.doInitialization(this,E)}}}},handlePropisAbstract:function(A){this.isAbstract=A},handlePropisa:function(A){if(A==null){throw new Error("Super class is null")}this.addSuperClass(A)},handleProphas:function(D){var C=this;if(typeof D=="string"){var A=arguments[0];var B=arguments[1];C.addAttribute(A,B)}else{Joose.O.eachSafe(D,function(F,E){C.addAttribute(E,F)})}},handlePropmethod:function(A,C,B){this.addMethod(A,C,B)},handlePropmethods:function(B){var A=this;Joose.O.eachSafe(B,function(D,C){A.addMethod(C,D)})},handlePropclassMethods:function(B){var A=this;Joose.O.eachSafe(B,function(C,D){A.addMethodObject(new A.classMethodMetaClass(D,C))})},handlePropbefore:function(B){var A=this;Joose.O.eachSafe(B,function(D,C){A.wrapMethod(C,"before",D)})},handlePropafter:function(B){var A=this;Joose.O.eachSafe(B,function(D,C){A.wrapMethod(C,"after",D)})},handleProparound:function(B){var A=this;Joose.O.eachSafe(B,function(D,C){A.wrapMethod(C,"around",D)})},handlePropoverride:function(B){var A=this;Joose.O.eachSafe(B,function(D,C){A.wrapMethod(C,"override",D)})},handlePropaugment:function(B){var A=this;Joose.O.eachSafe(B,function(D,C){A.wrapMethod(C,"augment",D,function(){A.addMethod(C,D)})})}});Joose.Kernel.Handlers=handlersMeta.getClassObject();var advancedProtoAttributeMeta=new Joose.Kernel.Handlers("Joose.Kernel.AdvancedProtoAttribute");advancedProtoAttributeMeta.initializeFromProps({isa:Joose.Kernel.ProtoAttribute,before:{handleProps:function(A){this.handleIs(A)}},after:{handleProps:function(A){this.handlePredicate(A)}},methods:{getIsa:function(){var A=this.getProps();if("isa" in A&&A.isa==null){throw new Error("You declared an isa property but the property is null.")}if(A.isa){if(!A.isa.meta){return A.isa()}return A.isa}return},makeTypeChecker:function(D,C,B,A){var A=this.getName();return function E(F){this[A]=F;return this}},addSetter:function(E){var F=E.meta;var B=this.getName();var C=this.getProps();var A=this.setterName();if(F.can(A)){return}var G=this.getIsa();var D=this.makeTypeChecker(G,C,"attribute",B);F.addMethod(A,D)},addGetter:function(C){var I=C.meta;var A=this.getName();var D=this.getProps();var F=this.getterName();if(I.can(F)){return}var B=function E(){return this[A]};var H=D.init;if(D.lazy){B=function G(){var J=this[A];if(typeof J=="function"&&J===H){this[A]=J.apply(this)}return this[A]}}I.addMethod(F,B)},initializerName:function(){return this.toPublicName()},getterName:function(){if(this.__getterNameCache){return this.__getterNameCache}this.__getterNameCache="get"+Joose.S.uppercaseFirst(this.toPublicName());return this.__getterNameCache},setterName:function(){if(this.__setterNameCache){return this.__setterNameCache}this.__setterNameCache="set"+Joose.S.uppercaseFirst(this.toPublicName());return this.__setterNameCache},handleIs:function(C){var A=this.getProps();var B=A.is;if(B=="rw"||B=="ro"){this.addGetter(C)}if(B=="rw"){this.addSetter(C)}},isPersistent:function(){var A=this.getProps();if(A.persistent==false){return false}return true},doInitialization:function(B,I){var A=this.initializerName();var G=this.getName();var F;var E=false;if(typeof I!="undefined"&&typeof I[A]!="undefined"){F=I[A];E=true}else{var D=this.getProps();var H=D.init;if(typeof H=="function"&&!D.lazy){F=H.call(B);E=true}else{if(D.required){throw"Required initialization parameter missing: "+A+"(While initializing "+B+")"}}}if(E){var C=this.setterName();if(B.meta.can(C)){B[C](F)}else{B[G]=F}}},handlePredicate:function(E){var F=E.meta;var C=this.getName();var D=this.getProps();var B=D.predicate;var A=this.getterName();if(B){F.addMethod(B,function(){var G=this[A]();return G?true:false})}}}});Joose.Kernel.AdvancedProtoAttribute=advancedProtoAttributeMeta.getClassObject();var namespaceMeta=new Joose.Kernel.Handlers("Joose.Kernel.Namespace");namespaceMeta.initializeFromProps({isa:Joose.Kernel.Handlers,has:{parent:{},localName:{},namespaceElements:{},container:{},externalConstructor:{},version:{},presence:{},url:{},loading:{init:false},loaded:{init:false},ready:{init:false},readyListeners:{},transport:{init:"ajaxAsync"},BEGIN:{},beginStarted:{init:false},dependenciesGroup:{},delegatedToGroup:{init:false},dependencies:{}},after:{initialize:function(B,A){this.namespaceElements={};this.localName=this._name.split(".").pop();this.container=this.nextGeneration;this.dependencies={};this.readyListeners=[]}},classMethods:{getCurrentNamespace:function(){var A=50;var D="getCurrentNamespace() failed with limit="+A;var C=arguments.callee.caller;while(C&&A){if(C.__JOOSE_MODULE__){return C.__JOOSE_MODULE__}try{C=C.caller}catch(B){C=null}A--}if(A){return __global__}throw D},prepareNamespace:function(D){var G=D.split(".");if(G.length&&!G[0]){G.shift()}if(!G.length){throw"Cant prepare namespace with empty name = ["+D+"]"}var C=this.getCurrentNamespace();var A=C.meta.getName().split(".");if(A.length&&!A[0]){A.shift()}for(var E=0;E<G.length;E++){var B=G[E];if(B=="meta"){throw"Module names may not include a part called 'meta'."}if(!B){throw"Module names may not include an empty part."}A.push(B);var D=A.join(".");var H=C.meta.container[B];if(typeof H=="undefined"){var F=new Joose.Kernel.NamespaceKeeper(D).getClassObject();C.meta.addElement(F.meta.localName,F)}else{if(!(H&&H.meta&&H.meta.meta&&H.meta.meta.isa(Joose.Kernel.Namespace))){throw"Trying to setup module "+D+" failed. There is already something: "+H}}C=C.meta.container[B]}return C},prepareVirtualNamespace:function(A){this.virtualNamespaces=this.virtualNamespaces||{};if(this.virtualNamespaces[A]){return this.virtualNamespaces[A]}return(this.virtualNamespaces[A]=new Joose.Kernel.Namespace(A).getClassObject())},create:function(A,C){var B=Joose.Kernel.Namespace.prepareNamespace(A);B.meta.initializeFromProps(C);return B},use:function(B,D,A){var C=new Joose.Kernel.Namespace("").getClassObject();C.meta.initializeFromProps({use:B,body:function(){D.call(A||this)}})},executeInNamespace:function(B,D,C,E){var A=function(G,F){arguments.callee.__JOOSE_MODULE__=F;return G.apply(C||this,E||[])};return A(D,B)}},before:{addClassMethod:function(A,B){if(this.hasElement(A)){throw"Collision between existing namespace element ["+this.namespaceElements[A]+"] and a new classMethod ["+A+"]"}}},override:{initializeFromProps:function(B){var C=this.nextGeneration;this.loaded=true;this.loading=false;if(B&&B.use){var A=B.use;delete B.use;C.meta.readyListeners.unshift(function(){var D=B.body;delete B.body;C.meta.initializeFromProps(B);C.meta._initializeFromProp("body",D,B)});C.meta._initializeFromProp("BEGIN",B.BEGIN,B);delete B.BEGIN;C.meta._initializeFromProp("use",A,B)}else{this.ready=true;if(this.dependenciesGroup&&__JOOSE_LIBRARIAN_ENABLED__){this.delegatedToGroup=true;this.dependenciesGroup.handleLoad()}return this.SUPER(B)}}},methods:{handlePropBEGIN:function(B,A){if(this.BEGIN){throw"Double declaration of BEGIN property for module=["+this.nextGeneration+"]"}this.BEGIN=B},handlePropbody:function(A){if(A){Joose.Kernel.Namespace.executeInNamespace(this.nextGeneration,A,this.container,[this.nextGeneration])}},handlePropversion:function(A){this.version=A},dependsFrom:function(B){for(var A in this.dependencies){if(this.dependencies.hasOwnProperty(A)){if(this.dependencies[A].Module==B){return true}}}for(A in this.dependencies){if(this.dependencies.hasOwnProperty(A)){if(this.dependencies[A].Module.meta.dependsFrom(B)){return true}}}return false},prepareDependencyDescriptor:function(thisNamespace,descriptor){if(typeof descriptor=="string"){descriptor={Module:descriptor}}if(descriptor.Module&&descriptor.url){throw"Dependency of ["+thisNamespace+"] from external url=["+descriptor.url+"], can't have Module defined ["+descriptor.Module+"]"}if(/^ext:\/\//.test(descriptor.Module)){descriptor.Module=descriptor.Module.replace(/^ext:\/\//,"");var moduleName=descriptor.Module;descriptor.presence=function(){return eval(moduleName)}}var depName=descriptor.Module||descriptor.url;if(!depName){throw"Empty dependency name for Module=["+thisNamespace+"]"}descriptor.depName=depName;if(thisNamespace.meta.dependencies[depName]&&thisNamespace.meta.dependencies[depName].version!=descriptor.version){throw"Repeated usage of "+depName+" with different version number for Module=["+thisNamespace+"]"}if(!thisNamespace.meta.dependencies[depName]){if(descriptor.Module){if(descriptor.presence){descriptor.Module=Joose.Kernel.Namespace.prepareVirtualNamespace(descriptor.Module);if(!descriptor.Module.meta.presence){descriptor.Module.meta.presence=descriptor.presence}}else{descriptor.Module=Joose.Kernel.Namespace.executeInNamespace(__global__,function(){return Joose.Kernel.Namespace.prepareNamespace(descriptor.Module)})}if(descriptor.transport){if(descriptor.Module.meta.hasOwnProperty("transport")&&descriptor.Module.meta.transport!=descriptor.transport){throw"Error : redeclaration of transport property for dependency "+descriptor.Module+" in Module=["+thisNamespace+"]"}descriptor.Module.meta.transport=descriptor.transport}}else{descriptor.Module=Joose.Kernel.Namespace.prepareVirtualNamespace(descriptor.url);descriptor.Module.meta.url=descriptor.url;descriptor.Module.meta.transport="script"}if(__JOOSE_DETECT_DEADLOCKS__&&descriptor.Module.meta.dependsFrom(thisNamespace)){throw"Cyclic reference detected between: ["+thisNamespace+"] and ["+descriptor.Module+"]"}}if(!descriptor.Module.dependenciesGroup){descriptor.Module.dependenciesGroup=thisNamespace.meta.dependenciesGroup}return descriptor},handlePropuse:function(C,B){this.dependenciesGroup=this.dependenciesGroup||new Joose.Kernel.DependenciesGroup("");var D=this.nextGeneration;if(!(C instanceof Array)){C=[C]}Joose.A.each(C,function(G){G=D.meta.prepareDependencyDescriptor(D,G);var F=G.depName;if(!D.meta.dependencies[F]){var E=G.Module;if(!E.meta.ready){E.meta.readyListeners.push(function(){if(G.version){if(!E.meta.version){throw"Loaded descriptor "+E+" has no specified version. Required version is: "+G.version}if(E.meta.version<G.version){throw"Loaded descriptor "+E+" has lower version ["+E.meta.version+"] than required ["+G.version+"]"}}delete D.meta.dependencies[F];D.meta.checkDependencies()});D.meta.dependencies[F]=G;D.meta.ready=false}}});if(__JOOSE_LIBRARIAN_ENABLED__){var A=D.meta.dependenciesGroup;Joose.O.eachSafe(D.meta.dependencies,function(F){var E=F.Module;if(F.url||E.dependenciesGroup!=A){E.meta.handleLoad();return}A.addDescriptor(F)});D.meta.delegatedToGroup=true;A.handleLoad()}else{Joose.O.eachSafe(D.meta.dependencies,function(E){E.Module.meta.handleLoad()})}D.meta.checkDependencies()},checkDependencies:function(){for(var A in this.dependencies){if(this.dependencies.hasOwnProperty(A)){return}}if(this.BEGIN){if(!this.beginStarted){this.beginStarted=true;var B=this;this.BEGIN.call(this.nextGeneration,function(){B.beginStarted=false;delete B.BEGIN;B.fireReady()})}}else{this.fireReady()}},fireReady:function(){this.ready=true;var A=this.readyListeners;this.readyListeners=[];Joose.A.each(A,function(B){B()})},getUrls:function(){if(this.url){return typeof this.url=="function"?this.url():this.url}var B=[];var A=this._name.split(".");Joose.A.each(__JOOSE_INC__,function(C){B.push(C.concat(A).join("/")+".js"+(__JOOSE_DISABLE_CACHING__?"?disableCaching=true":""))});return B},handleLoad:function(){var C=this.nextGeneration;try{if(this.loaded||typeof this.presence=="function"&&this.presence()){this.checkDependencies();return}}catch(E){}if(this.loading){return}this.loading=true;var D=this.getUrls();if(!(D instanceof Array)){D=[D]}var B=function(){C.meta.loaded=true;C.meta.loading=false;C.meta.checkDependencies()};var A=function(){if(!D.length){throw"Module=["+C+"] not found"}Joose.Kernel.Namespace.transports[C.meta.transport].call(C.meta,D.shift(),B,A)};A.__JOOSE_MODULE__=__global__;Joose.Kernel.Namespace.transports[this.transport].call(this,D.shift(),B,A)},alias:function(A){for(var B in this.namespaceElements){if(this.namespaceElements.hasOwnProperty(B)){if(A[B]&&A[B]!=this.namespaceElements[B]){throw"Aliasing of "+this._name+" to "+A+" failed, there is already something: "+A[B]}A[B]=this.namespaceElements[B]}}return this},hasElement:function(A){return this.namespaceElements.hasOwnProperty(A)&&Boolean(this.namespaceElements[A])},getElement:function(A){if(typeof this.container.hasOwnProperty=="function"){return this.container.hasOwnProperty(A)&&this.container[A]||null}return this.container[A]},addElement:function(A,B){if(this.classCan(A)){throw"Collision between existing classMethod ["+A+"] of "+this+" and a new namespace element ["+B+"]"}if(this.hasElement(A)){throw"Adding namespace element failed: namespace element ["+A+"] already exists in the ["+this._name+"]"}this.namespaceElements[A]=B;this.container[A]=B;if(B&&B.meta){B.meta.parent=this.nextGeneration}},removeElement:function(A){var B=this.namespaceElements[A];delete B.parent;delete this.namespaceElements[A];try{delete this.container[A]}catch(C){this.container[A]=undefined}return B},getElementNames:function(){var A=[];Joose.O.eachSafe(this.namespaceElements,function(B,C){A.push(C)});return A}}});Joose.Kernel.Namespace=namespaceMeta.getClassObject();use=function(){Joose.Kernel.Namespace.use.apply(Joose.Kernel.Namespace,arguments)};__JOOSE_INC__=[["../localLib/root1"],["../localLib/root2"]];__JOOSE_DETECT_DEADLOCKS__=false;__JOOSE_DISABLE_CACHING__=true;__JOOSE_LIBRARIAN_ENABLED__=true;__JOOSE_LIBRARIAN_ROOT__=["/librarian"];Joose.Kernel.Namespace.transports={script:function(D,C,B){var A=document.createElement("script");A.onload=A.onreadystatechange=function(){if(!A.readyState||A.readyState=="loaded"||A.readyState=="complete"||A.readyState==4&&A.status==200){setTimeout(function(){C()},1)}};A.setAttribute("type","text/javascript");A.setAttribute("src",D);document.getElementsByTagName("head")[0].appendChild(A)},ajaxAsync:function(url,onready,onerror){var req=new Joose.SimpleRequest();try{req.getText(url,true,function(success,text){if(!success){onerror();return}eval(text);onready()})}catch(e){onerror()}},ajaxSync:function(url,onready,onerror){var req=new Joose.SimpleRequest();var text;try{text=req.getText(url)}catch(e){onerror();return}eval(text);onready()}};var dependenciesGroupMeta=new Joose.Kernel.Namespace("Joose.Kernel.DependenciesGroup");dependenciesGroupMeta.initializeFromProps({isa:Joose.Kernel.Namespace,methods:{handleLoad:function(){var me=this;var haveLoadedButNotDelegated=false;var haveAny=false;Joose.O.eachSafe(this.dependencies,function(descriptor){var depName=descriptor.depName;if(me.dependencies[depName].Module.meta.delegatedToGroup){delete me.dependencies[depName]}});Joose.O.eachSafe(this.dependencies,function(descriptor){haveAny=true;var depName=descriptor.depName;if(me.dependencies[depName].Module.meta.loaded){haveLoadedButNotDelegated=true}});if(haveLoadedButNotDelegated||!haveAny){return}var req=new Joose.SimpleRequest();var me=this;var onerror=function(){throw"Failed to load dependencies bundle: "+me.stringifyDependencies()};try{req.getText({url:this.getUrls(),headers:{"X-Joose-Bundle":this.stringifyDependencies()},async:true,callback:function(success,text){if(!success){onerror();return}eval(text);Joose.O.eachSafe(me.dependencies,function(descriptor){var virtualMeta=descriptor.Module.meta;if(descriptor.presence){virtualMeta.loaded=true;virtualMeta.loading=false}virtualMeta.checkDependencies()})}})}catch(e){onerror()}},addDescriptor:function(C){var A=C.Module;var B=C.depName;if(A.meta.loaded||A.meta.loading){return}A.meta.loading=true;if(this.dependencies[B]&&this.dependencies[B].version>C.version){return}this.dependencies[B]=C},stringifyDependencies:function(){var A=[];Joose.O.eachSafe(this.dependencies,function(C,B){A.push((C.presence?"ext://":"")+B+(C.version?"-"+C.version:""))});A.sort();return A.join(",")},getUrls:function(){return __JOOSE_LIBRARIAN_ROOT__.concat(Digest.MD5.md5_hex(this.stringifyDependencies())+".js").join("/")}}});Joose.Kernel.DependenciesGroup=dependenciesGroupMeta.getClassObject();var namespaceKeeperMeta=new Joose.Kernel.Namespace("Joose.Kernel.NamespaceKeeper");namespaceKeeperMeta.initializeFromProps({isa:Joose.Kernel.Namespace,methods:{defaultClassFunctionBody:function(){return function(){if(this.meta.constructor==Joose.Kernel.NamespaceKeeper){throw new Error("Modules may not be instantiated.")}if(typeof this.meta.externalConstructor=="function"){this.meta.externalConstructor.apply(this,arguments);return}throw new Error("NamespaceKeeper was planted incorrectly.")}}}});Joose.Kernel.NamespaceKeeper=namespaceKeeperMeta.getClassObject();__global__=new Joose.Kernel.NamespaceKeeper("",function(){throw"Global NamespaceKeeper can't be instantiated"}).getClassObject();__global__.meta._name="";__global__.meta.container=joose.top;__global__.meta.parent=__global__;new Joose.Kernel.NamespaceKeeper("Joose",Joose);new Joose.Kernel.NamespaceKeeper("Joose.Kernel",Joose.Kernel);__global__.meta.addElement("Joose",Joose);Joose.meta.addElement("Kernel",Joose.Kernel);var protoModuleMeta=new Joose.Kernel.Handlers("Joose.Kernel.ProtoModule");protoModuleMeta.initializeFromProps({isa:Joose.Kernel.Namespace,has:{attributeConstructor:{init:Joose.Kernel.AdvancedProtoAttribute,lazy:true}},classMethods:{create:function(A,C){var B=Joose.Kernel.Namespace.prepareNamespace(A);var E=B.meta._name;if(B.meta.constructor==Joose.Kernel.NamespaceKeeper){var D=new this(E).getClassObject();D.meta.parent=B.meta.parent;D.meta.namespaceElements=B.meta.namespaceElements;D.meta.container=B.meta.container;D.meta.loading=B.meta.loading;D.meta.loaded=B.meta.loaded;D.meta.ready=B.meta.ready;D.meta.readyListeners=B.meta.readyListeners;D.meta.dependencies=B.meta.dependencies;D.meta.delegatedToGroup=B.meta.delegatedToGroup;D.meta.dependenciesGroup=B.meta.dependenciesGroup;D.meta.BEGIN=B.meta.BEGIN;B.meta=D.meta;B.prototype=D.prototype;B.prototype.constructor=B;B.meta.nextGeneration=B;B.meta.externalConstructor=D;Joose.A.each(D.meta.getClassMethods(),function(F){F.addToClass(B)})}B.meta.initializeFromProps(C);return B}}});Joose.Kernel.ProtoModule=protoModuleMeta.getClassObject();Joose.Kernel.ProtoModule.create("Joose.Kernel.Roles",{isa:Joose.Kernel.ProtoModule,has:{roles:{init:null},myRoles:{init:null},isDetached:{init:false}},after:{initialize:function(){this.roles=[];this.myRoles=[]},adoptNextGeneration:function(){this.addDetacher()},addSuperClass:function(C){if(C.meta.meta.hasAttribute("roles")){var B=C.meta.roles;for(var A=0;A<B.length;A++){this.roles.push(B[A])}}},buildComplete:function(){this.validateClass()}},before:{buildComplete:function(){for(var A=0;A<this.roles.length;A++){this.roles[A].meta.applyMethodModifiers(this.nextGeneration)}}},methods:{apply:function(A){},applyMethodModifiers:function(A){},isImplementedBy:function(B,A){},addRole:function(A){this.dieIfString(A);if(A.meta.apply(this.getClassObject())){this.roles.push(A);this.myRoles.push(A)}},getRoles:function(){return this.roles},addDetacher:function(){this.addMethod("detach",function A(){var C=this.meta;if(C.isDetached){return}var D=C.makeAnonSubclass();D.meta.isDetached=true;this.meta=D.meta;this.constructor=D;var B;if(!this.__proto__){B=this}else{B={};Joose.copyObject(this,B)}D.prototype=B;this.__proto__=D.prototype;return})},validateClass:function(){var C=this.getClassObject();var B=this;var A=true;Joose.A.each(this.roles,function(D){D.meta.isImplementedBy(C,A)})},does:function(B){for(var A=0;A<this.roles.length;A++){if(B===this.roles[A]){return true}}for(var A=0;A<this.roles.length;A++){if(this.roles[A].meta.does(B)){return true}}return false},handlePropdoes:function(B){var A=this;if(B instanceof Array){Joose.A.each(B,function(C){A.addRole(C)})}else{A.addRole(B)}}}});var protoRoleMeta=new Joose.Kernel.Roles("Joose.Kernel.ProtoRole");protoRoleMeta.initializeFromProps({isa:Joose.Kernel.Roles,has:{requiresMethodNames:{},methodModifiers:{},metaRoles:{}},after:{initialize:function(){this.requiresMethodNames=[];this.methodModifiers=[]}},methods:{wrapMethod:function(B,D,C,A){this.methodModifiers.push(arguments)},requiresMethod:function(B){var A=false;Joose.A.each(this.requiresMethodNames,function(C){if(B==C){A=true}});return A},addInitializer:Joose.emptyFunction,addDetacher:Joose.emptyFunction,addToString:Joose.emptyFunction,defaultClassFunctionBody:function(){return function(){throw new Error("Roles may not be instantiated.")}},addSuperClass:function(){throw new Error("Roles may not inherit from a super class.")},addRequirement:function(A){this.requiresMethodNames.push(A)},handleProprequires:function(A){var B=this;if(!this.meta.isa(Joose.Kernel.ProtoRole)){throw ("Keyword 'requires' only available classes with a meta class of type Joose.Role")}if(A instanceof Array){Joose.A.each(A,function(C){B.addRequirement(C)})}else{B.addRequirement(A)}},unapply:function(B){if(!joose.isInstance(B)){throw new Error("You way only remove roles from instances.")}if(!B.meta.isDetached){throw new Error("You may only remove roles that were applied at runtime")}var C=this.getClassObject();var E=B.meta.myRoles;var I=false;var A=[];for(var D=0;D<E.length;D++){if(E[D]===C){I=true}else{A.push(E[D])}}if(!I){throw new Error("The role "+this.className()+" was not applied to the object at runtime")}var H=B.meta.getSuperClass();var G=H.meta.makeAnonSubclass();var F=new G();for(var D=0;D<A.length;D++){var C=A[D];G.meta.addRole(C)}G.prototype=F;B.meta=G.meta;B.constructor=G;B.__proto__=F},addMethodToClass:function(D,B){var A=D.getName();var C;if(this.classMethodMetaClass.meta.isa(D.constructor)){C=B.meta.getClassMethodObject(A)}else{C=B.meta.getMethodObject(A)}if(!C||C.isFromSuperClass()){B.meta.addMethodObject(D)}},addAttributeToClass:function(A,C){var B=A.getName();if(!C.meta.hasAttribute(B)){this.getAttribute(B).addToClass(C)}},apply:function(E){if(!E.meta.meta.can("addRole")){return false}if(E.meta.does(this.getClassObject())){return false}if(joose.isInstance(E)){E.detach();E.meta.addRole(this.getClassObject());this.applyMethodModifiers(E);var B=true;this.isImplementedBy(E,B)}else{var F=this;var D=F.getAttributes();Joose.O.each(D,function C(I){F.addAttributeToClass(I,E)});var G=F.getMethodNames();Joose.A.each(G,function H(I){F.addMethodToClass(F.getMethodObject(I),E)});G=F.getClassMethodNames();Joose.A.each(G,function H(I){F.addMethodToClass(F.getClassMethodObject(I),E)});if(this.metaRoles){Joose.A.each(this.metaRoles,function A(I){I.meta.apply(E.meta)})}}return true},applyMethodModifiers:function(A){Joose.A.each(this.methodModifiers,function B(C){A.meta.wrapMethod.apply(A.meta,C)})},hasRequiredMethods:function(D,B){var C=this;var A=true;Joose.A.each(this.requiresMethodNames,function(F){var E=D.meta.can(F);if(!E){if(B){throw ("Class "+D.meta.className()+" does not fully implement the role "+C.className()+". The method is "+F+" missing.")}A=false;return}});return A},isImplementedBy:function(C,B){var A=this.hasRequiredMethods(C,B);if(A){A=this.implementsMyMethods(C)}return A},implementsMyMethods:function(B){var A=true;Joose.A.each(this.getMethodNames(),function(D){var C=B.meta.can(D);if(!C){A=false}});Joose.A.each(this.getClassMethodNames(),function(D){var C=B.meta.classCan(D);if(!C){A=false}});return A},handlePropmetaRoles:function(A){this.metaRoles=A}}});Joose.Kernel.ProtoRole=protoRoleMeta.getClassObject();Joose.Kernel.ProtoRole.anonymousClassCounter=0;var metaClassMeta=new Joose.Kernel.Roles("Joose.Kernel.MetaClass");metaClassMeta.initializeFromProps({isa:Joose.Kernel.Roles});Joose.Kernel.MetaClass=metaClassMeta.getClassObject();Joose.Kernel.MetaClass.create("Joose.TypeConstraint",{has:{_constraints:{is:"ro",init:function(){return[]}},_coercions:{is:"ro",init:function(){return[]}},_messages:{is:"ro",init:function(){return[]}},_callback:{is:"ro",init:function(){return function(A){throw new ReferenceError(A)}}},_name:{is:"ro"},_uses:{is:"ro"},props:{is:"rw"}},classMethods:{create:function(C,H){var F=Joose.Kernel.Namespace.prepareNamespace(C);var G=F.meta.parent;var B=F.meta.localName;G.meta.removeElement(B);var E=new Joose.TypeConstraint({name:C});G.meta.addElement(B,E);if(H.uses&&typeof H.uses.meta!="undefined"&&H.uses.meta.isa(Joose.TypeConstraint)){E._uses=H.uses}if(H.where){E.addConstraint(H.where,H.message)}E.setProps(H);if(H.coerce){for(var D=0;D<H.coerce.length;D++){var A=H.coerce[D];E.addCoercion(new Joose.TypeCoercion({from:A.from,via:A.via}))}}return E}},methods:{stringify:function(){return this._name},makeSubType:function(A){var B=new Joose.TypeConstraint({name:A});Joose.A.each(this._constraints,function(C){B.addConstraint(C)});return B},addCoercion:function(A){this._coercions.push(A)},addConstraint:function(B,A){this._constraints.push(B);this._messages.push(A)},getConstraintList:function(){var A=this._constraints;if(this._uses){var B=this._uses.getConstraintList();return B.concat(A)}return A},getMessageList:function(){var B=this._messages;if(this._uses){var A=this._uses.getMessageList();return A.concat(B)}return B},validateBool:function(B){var A=this._validate(B);if(A==-1){return true}return false},validate:function(D){var A=this._validate(D);if(A==-1){return true}var C=this.getMessageList();var B=C[A]?C[A].call(this,D):"The passed value ["+D+"] is not a "+this;this._callback(B)},_validate:function(F){var C=this.getConstraintList();var D,B;for(D=0,B=C.length;D<B;D++){var E=C[D];var A=false;if(E instanceof RegExp){A=E.test(F)}else{A=E.call(this,F)}if(!A){return D}}return -1},coerce:function(F){if(this.validateBool(F)){return F}var E=this._coercions;for(var D=0,B=E.length;D<B;D++){var C=E[D];var A=C.coerce(F);if(A!==null){return A}}return null}}});Joose.Kernel.MetaClass.create("Joose.Attribute",{isa:Joose.Kernel.AdvancedProtoAttribute,methods:{makeTypeChecker:function(F,G,H,A){var C;if(F){if(!F.meta){throw new Error("Isa declarations in attribute declarations must be Joose classes, roles or type constraints")}var I=false;var D=false;if(Joose.Role&&F.meta.meta.isa(Joose.Role)){I=true}else{if(Joose.TypeConstraint&&F.meta.isa(Joose.TypeConstraint)){D=true}}C=function B(O,L){var M=O;try{if(G.nullable===true&&M==undefined){}else{if(D){var K=null;if(G.coerce){K=F.coerce(M)}if(K==null&&G.nullable!==true){F.validate(M)}else{M=K}}else{if(!M||!M.meta){throw new ReferenceError("The attribute "+A+" only accepts values that have a meta object.")}var J=I?M.meta.does(F):M.meta.isa(F);if(!J){throw new ReferenceError("The attribute "+A+" only accepts values that are objects of type "+F.meta.className()+".")}}}}catch(N){if(L){L.call(this,N,F)}else{throw N}}this[A]=M;return this}}else{C=function E(J){this[A]=J;return this}}return C},handleHandles:function(E){var F=E.meta;var A=this.getName();var C=this.getProps();var B=C.handles;var G=C.isa;if(B){if(B=="*"){if(!G){throw"I need an isa property in order to handle a class"}var D=C.handleWith;F.decorate(G,A,D)}else{throw"Unsupported value for handles: "+B}}}},after:{handleProps:function(A){this.handleHandles(A)}}});Joose.Kernel.MetaClass.meta.addAttribute("attributeConstructor",{init:Joose.Attribute,lazy:true});Joose.Kernel.MetaClass.create("Joose.Method",{isa:Joose.Kernel.ProtoMethod});Joose.Kernel.MetaClass.meta.addAttribute("methodConstructor",{init:Joose.Method,lazy:true});Joose.Kernel.MetaClass.create("Joose.ClassMethod",{isa:Joose.Kernel.ProtoClassMethod});Joose.Kernel.MetaClass.meta.addAttribute("classMethodMetaClass",{init:Joose.ClassMethod,lazy:true});Joose.Kernel.MetaClass.create("Joose.Class",{isa:Joose.Kernel.MetaClass});Joose.Builder=function(){this.globalize=function(){Joose.O.each(Joose.Builder.Globals,function(C,A){var B="Joose"+A;if(typeof joose.top[A]=="undefined"){joose.top[A]=C}joose.top[B]=C})}};Joose.Builder.Globals={Module:function(A,B){if(typeof B=="function"){B={body:B}}return Joose.Kernel.Namespace.create(A,B)},Role:function(A,B){if(!B.meta){B.meta=Joose.Role}return JooseClass(A,B)},Prototype:function(A,B){if(!B.meta){B.meta=Joose.Prototype}return JooseClass(A,B)},Class:function(B,C){var A;if(C&&C.meta){A=C.meta;delete C.meta}else{if(C&&C.isa&&C.isa!=Joose.Class){A=C.isa.meta.constructor}else{A=Joose.Class}}if(!A.meta.classCan("create")){throw"MetaClass ["+A+"] can't be used with Class builder (have no class method 'create')"}return A.create(B,C)},Type:function(B,C){if(typeof TYPE=="undefined"){JooseModule("TYPE")}var A=Joose.Kernel.Namespace.getCurrentNamespace();if(A==__global__){A=TYPE}return Joose.Kernel.Namespace.executeInNamespace(A,Joose.TypeConstraint.create,Joose.TypeConstraint,[B,C])},joosify:function(B,C){var A=new Joose.Class(B,C);Joose.O.eachSafe(C.prototype,function(F,D){if(D=="meta"||D=="constructor"){return}if(typeof(F)=="function"){A.addMethod(D,F)}else{var E={};if(typeof(F)!="undefined"){E.init=F}A.addAttribute(D,E)}});return A.getClassObject()},rw:"rw",ro:"ro"};joose.init();(function(B,A){A("CoercionFrom",{where:function(C){if(C.meta&&C.meta.isa(Joose.TypeConstraint)){return true}return false}});B("Joose.TypeCoercion",{has:{_from:{isa:TYPE.CoercionFrom,is:"rw"},_via:{is:"rw"}},methods:{coerce:function(C){if(this._from.validateBool(C)){return this._via(C)}return null}}})})(JooseClass,JooseType);(function(A){A("Any",{where:function(B){return true}});A("Null",{uses:TYPE.Any,where:function(B){if(B===null){return true}return false}});A("NotNull",{uses:TYPE.Any,where:function(B){if(B===null){return false}return true}});A("Enum",{uses:TYPE.NotNull,message:function(B){return"The passed value ["+B+"] is not "+(this.getProps().strictMatch?"*strictly* ":"")+"one of ["+this.getProps().values.join(",")+"]"},where:function(D){var C=this;if(!C.getProps()||C.getProps().values===undefined||!(C.getProps().values instanceof Array)){throw"Enum Type needs Array of values in 'values' property of Type declaration"}var B=function(E){if(C.getProps().strictMatch===true){return(E===D)}return(E==D)};if(Joose.A.grep(C.getProps().values,B).length!=0){return true}return false}});A("Obj",{uses:TYPE.NotNull,where:function(B){if(B instanceof Object){return true}return false}});A("Str",{uses:TYPE.NotNull,where:function(B){if(typeof B=="string"||B instanceof String){return true}return false},coerce:[{from:TYPE.Any,via:function(B){if(B==null){return""}else{return""+B}}}]});A("Num",{uses:TYPE.NotNull,where:function(B){if(typeof B=="number"||B instanceof Number){return true}return false},coerce:[{from:TYPE.Str,via:function(B){if(B==null||B==""){return undefined}return parseFloat(B)}}]});A("Bool",{uses:TYPE.NotNull,where:function(C){if(C===true||C===false){return true}return false},coerce:[{from:TYPE.Any,via:function(B){if(B==null||B===""){return undefined}if(B==1||B=="1"||B=="true"){return true}if(B==0||B=="0"||B=="false"){return false}return null}}]});A("Int",{uses:TYPE.Num,where:function(C){var B=String(C);if(B.match(/^\d*\.\d$/)){return false}return true},coerce:[{from:TYPE.Str,via:function(B){if(B==null||B==""){return undefined}if(B.match(/^-{0,1}\d+$/)){return parseInt(B)}return}}]});A("Float",{uses:TYPE.Num,where:function(B){return true}});A("Func",{uses:TYPE.Obj,where:function(B){if(typeof B=="function"){return true}return false}});A("Array",{uses:TYPE.Obj,where:function(B){if(B instanceof Array){return true}return false}});A("Date",{uses:TYPE.Obj,where:function(B){if(B instanceof Date){return true}return false},coerce:[{from:TYPE.Str,via:function(C){var B;if(C==undefined||C==""){return undefined}else{if(B=C.match(/\s*(\d+)-(\d+)-(\d+)/)){return new Date(B[1],B[2]-1,[B[3]])}}return null}}]});A("Joose",{uses:TYPE.Obj,where:function(B){if(B.meta&&B.meta.meta.isa(Joose.Class)){return true}return false}})})(JooseType);Class("Joose.Role",{isa:Joose.Kernel.ProtoRole,meta:Joose.Class});(function(A){A("Joose.SimpleRequest",{has:{_req:{}},methods:{initialize:function(){if(window.XMLHttpRequest){this._req=new XMLHttpRequest()}else{this._req=new ActiveXObject("Microsoft.XMLHTTP")}},getText:function(E,D,I,C){var F=this._req;var H;var B;if(typeof E!="string"){H=E.headers;B=E.url;D=D||E.async;I=I||E.callback;C=C||E.scope}else{B=E}F.open("GET",B,D||false);if(H){Joose.O.eachSafe(H,function(K,J){F.setRequestHeader(J,K)})}try{F.onreadystatechange=function(J){if(D&&F.readyState==4){if(F.status==200||F.status==0){I.call(C||this,true,F.responseText)}else{I.call(C||this,false,"File not found: "+B)}}};F.send(null)}catch(G){throw"File not found: "+B}if(!D){if(F.status==200||F.status==0){return F.responseText}else{throw"File not found: "+B}}return null}}})})(JooseClass);(function(A){A("Joose.Gears",{isa:Joose.Class,has:{wp:{},calls:{init:{}},callIndex:{init:0}},after:{initialize:function(){JooseGearsInitializeGears();if(this.canGears()){this.wp=google.gears.factory.create("beta.workerpool");var B=this;this.wp.onmessage=function(D,C,E){B.handleGearsMessage(E)}}}},methods:{handlePropworkers:function(C){var B=this;Joose.O.eachSafe(C,function(E,D){B.addWorker(D,E)})},handleGearsMessage:function(E){var D=E.body;var F=D.to;var C=D.ret;var B=this.calls[D.index];if(B.meta.can(F)){B[F].call(B,C)}},canGears:function(){return window.google&&window.google.gears&&window.google.gears.factory},addWorker:function(C,D,I){var E="on"+Joose.S.uppercaseFirst(C);var L=this.meta.getClassObject().ajaxRequest;if(!this.canGears()){var J=function(){var P=this;var O={sendReturn:function(Q,R){if(P.meta.can(R)){P[R].call(P,Q)}},clientHasGears:function(){return false},ajaxRequest:L};var N=D.apply(O,arguments);O.sendReturn(N,E)};this.addMethod(C,J,I);return}var G=this.can("jsonURL")?this.nextGeneration.jsonURL():"json2.js";var M=new Joose.SimpleRequest().getText(G);var B="var timer = google.gears.factory.create('beta.timer');\nfunction aClass () {}; aClass.prototype."+C+" = "+D.toString()+"\n\naClass.prototype.clientHasGears = function () { return true }\naClass.prototype.ajaxRequest = "+L.toString()+"\n\nvar wp = google.gears.workerPool;\nwp.onmessage = function (a,b,message) {\nvar paras = message.body;\nvar o = new aClass();\no.sendReturn = function (ret, cbName) { wp.sendMessage({ ret: ret, to: cbName, index: paras.index }, message.sender) } \nvar ret = o."+C+".apply(o, paras.args); if(!ret) ret = null; \no.sendReturn(ret, paras.cbName);\n}\n\n";B+=M;var K=this.wp;var F=K.createWorker(B);var H=this;var J=function(){var N=[];for(var O=0;O<arguments.length;O++){N.push(arguments[O])}var P={args:N,cbName:E,index:H.callIndex};K.sendMessage(P,F);H.calls[H.callIndex]=this;H.callIndex++};this.addMethod(C,J,I)}},classMethods:{setupGearsCompat:function(){window.timer={setTimeout:function(B,C){return window.setTimeout(B,C)},setInterval:function(B,C){return window.setInterval(B,C)},clearTimeout:function(B){return window.clearTimeout(B)},clearInterval:function(B){return window.clearInterval(B)}}},clientHasGears:function(){return window.google&&window.google.gears&&window.google.gears.factory},ajaxRequest:function(B,C,F,K,H){var E;if(this.clientHasGears()){E=google.gears.factory.create("beta.httprequest")}else{E=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest()}var I="";if(F){for(var G in F){I+=encodeURIComponent(G)+"="+encodeURIComponent(F[G])+"&"}}var D=C;if(F&&B=="GET"){D+="?"+I}E.open(B,D,true);E.onreadystatechange=function J(){if(E.readyState==4){if(E.status>=200&&E.status<400){var L=E.responseText;K(L)}else{if(H){return H(E)}else{throw new Error("Error fetching url "+D+". Response code: "+E.status+" Response text: "+E.responseText)}}}};if(F&&B=="POST"){E.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");E.send(I)}else{I="";E.send(I)}}}})})(JooseClass);function JooseGearsInitializeGears(){if(window.google&&google.gears){return}var A=null;if(typeof GearsFactory!="undefined"){A=new GearsFactory()}else{try{A=new ActiveXObject("Gears.Factory");if(A.getBuildInfo().indexOf("ie_mobile")!=-1){A.privateSetGlobalObject(this)}}catch(B){if(navigator.mimeTypes["application/x-googlegears"]){A=document.createElement("object");A.style.display="none";A.width=0;A.height=0;A.type="application/x-googlegears";document.documentElement.appendChild(A)}}}if(!A){return}if(!window.google){google={}}if(!google.gears){google.gears={factory:A}}}(function(A,B){B("Joose.Storage",{methods:{toJSON:function(){var C=this.pack(Joose.Storage.TEMP_SEEN);return C},identity:function(){if(this.__ID__){return this.__ID__}else{return this.__ID__=Joose.Storage.OBJECT_COUNTER++}},pack:function(C){return this.meta.nextGeneration.storageEngine().pack(this,C)}},classMethods:{storageEngine:function(){return Joose.Storage.Engine},unpack:function(C){return this.storageEngine().unpack(this,C)}}});B("Joose.Storage.jsonpickle",{does:Joose.Storage,classMethods:{storageEngine:function(){return Joose.Storage.Engine.jsonpickle}}});Joose.Storage.OBJECT_COUNTER=1;A("Joose.Storage.Engine",{classMethods:{pack:function(E,C){if(C){var I=E.identity();var G=C[I];if(G){return{__ID__:I}}}if(E.meta.can("prepareStorage")){E.prepareStorage()}if(C){C[E.identity()]=true}var H={__CLASS__:this.packedClassName(E),__ID__:E.identity()};var D=E.meta.getAttributes();Joose.O.eachSafe(D,function F(J,K){if(J.isPersistent()){H[K]=E[K]}});return H},unpack:function(E,D){var G=E.meta;var C=G.instantiate();var F=false;Joose.O.eachSafe(D,function H(K,I){if(I=="__CLASS__"){var J=Joose.Storage.Unpacker.packedClassNameToJSClassName(K);if(J!=C.meta.className()){throw new Error("Storage data is of wrong type "+J+". I am "+C.meta.className()+".")}F=true;return}C[I]=K});if(!F){throw new Error("Serialized data needs to include a __CLASS__ attribute.: "+D)}delete C.__ID__;if(C.meta.can("finishUnpack")){C.finishUnpack()}return C},packedClassName:function(D){if(D.meta.can("packedClassName")){return D.packedClassName()}var C=D.meta.className();var E=C.split(".");return E.join("::")}}});A("Joose.Storage.Engine.jsonpickle",{classMethods:{pack:function(E,C){if(C){var I=E.identity();var G=C[I];if(G){return{objectid__:I}}}if(E.meta.can("prepareStorage")){E.prepareStorage()}if(C){C[E.identity()]=true}var H={classname__:this.packedClassName(E),classmodule__:this.packedModuleName(E),objectid__:E.identity()};var D=E.meta.getAttributes();Joose.O.eachSafe(D,function F(J,K){if(J.isPersistent()){H[K]=E[K]}});return H},unpack:function(E,D){var G=E.meta;var C=G.instantiate();var F=false;Joose.O.eachSafe(D,function H(L,I){if(I=="classname__"){var K=L;var J=D.classmodule__;if(J){K=""+J+"."+L}if(K!=C.meta.className()){throw new Error("Storage data is of wrong type "+K+". I am "+C.meta.className()+".")}F=true;return}if(I=="classmodule__"){return}C[I]=L});if(!F){throw new Error("Serialized data needs to include a __CLASS__ attribute.: "+D)}if(C.meta.can("finishUnpack")){C.finishUnpack()}return C},packedClassName:function(D){var C=D.meta.className();var E=C.split(".");return E.pop()},packedModuleName:function(D){var C=D.meta.className();var E=C.split(".");E.pop();return E.join(".")}}});Joose.Storage.storageEngine=Joose.Storage.Engine;Joose.Storage.jsonpickle.storageEngine=Joose.Storage.Engine.jsonpickle})(JooseClass,JooseRole);(function(A){A("Joose.Storage.Unpacker",{classMethods:{unpack:function(D){var C=D.__CLASS__;if(!C){throw ("Serialized data needs to include a __CLASS__ attribute.")}var B=this.packedClassNameToJSClassName(C);var F=this.meta.classNameToClassObject(B);var E=F.unpack(D);var G;if(Joose.Storage.CACHE&&(G=D.__ID__)){Joose.Storage.CACHE[G]=E}return E},packedClassNameToJSClassName:function(B){var C=B.split("-");C=C[0].split("::");return C.join(".")},jsonParseFilter:function(B,C){if(C!=null&&typeof C=="object"){if(C.__CLASS__){return Joose.Storage.Unpacker.unpack(C)}if(C.__ID__){return Joose.Storage.CACHE[C.__ID__]}}return C},patchJSON:function(){var D=JSON.parse;var B=this.jsonParseFilter;JSON.parse=function(G,F){Joose.Storage.CACHE={};return D(G,function E(H,I){var J=I;if(F){J=F(H,I)}return B(H,J)})};var C=JSON.stringify;JSON.stringify=function(){Joose.Storage.TEMP_SEEN={};return C.apply(JSON,arguments)}}}});A("Joose.Storage.Unpacker.jsonpickle",{isa:Joose.Storage.Unpacker,classMethods:{unpack:function(D){var C=D.classname__;if(!C){throw ("Serialized data needs to include a classname__ attribute.")}var B=this.packedClassNameToJSClassName(C,D.classmodule__);var F=this.meta.classNameToClassObject(B);var E=F.unpack(D);var G;if(Joose.Storage.CACHE&&(G=D.objectid__)){Joose.Storage.CACHE[G]=E}return E},packedClassNameToJSClassName:function(D,C){var B="";if(C){B+=C+"."}B+=D;return B},jsonParseFilter:function(B,C){if(C!=null&&typeof C=="object"){if(C.classname__){return Joose.Storage.Unpacker.jsonpickle.unpack(C)}if(C.objectid__){return Joose.Storage.CACHE[C.objectid__]}}return C}}})})(JooseClass);(function(A){A("Joose.Decorator",{meta:Joose.Role,methods:{decorate:function(F,D,C){var E=this;var B=F.meta.getInstanceMethods();Joose.A.each(B,function(G){var H=G.getName();var J=D;if(!E.can(H)){var I=function(){var K=this[J];return K[H].apply(K,arguments)};if(C){I=C(H)}E.addMethod(H,I)}})},handlePropdecorates:function(C){var B=this;Joose.O.eachSafe(C,function(E,D){B.decorate(E,D)})}}});Joose.Decorator.meta.apply(Joose.Class)})(JooseClass);(function(A){A("Joose.Prototype",{isa:Joose.Class,override:{initializer:function(){var B=this.SUPER();return function(){B.apply(this,arguments);var C=this.meta;this.meta=new Joose.PrototypeLazyMetaObjectProxy();this.meta.metaObject=C;this.meta.object=this}}}});A("Joose.PrototypeLazyMetaObjectProxy",{has:{metaObject:{is:"rw",isa:Joose.Class,handles:"*",handleWith:function(B){return function(){var C=this.object;C.meta=this.metaObject;C.detach();C.meta[B].apply(C.meta,arguments)}}},object:{is:"rw"}}})})(JooseClass);Class("Digest.MD5",{classMethods:{md5_hex:function(M){var K=0;var H=8;function F(N,Q){var P=(N&65535)+(Q&65535);var O=(N>>16)+(Q>>16)+(P>>16);return(O<<16)|(P&65535)}function J(N,O){return(N<<O)|(N>>>(32-O))}function B(S,P,O,N,R,Q){return F(J(F(F(P,S),F(N,Q)),R),O)}function G(P,O,T,S,N,R,Q){return B((O&T)|((~O)&S),P,O,N,R,Q)}function C(P,O,T,S,N,R,Q){return B((O&S)|(T&(~S)),P,O,N,R,Q)}function I(P,O,T,S,N,R,Q){return B(O^T^S,P,O,N,R,Q)}function E(P,O,T,S,N,R,Q){return B(T^(O|(~S)),P,O,N,R,Q)}function D(X,S){X[S>>5]|=128<<((S)%32);X[(((S+64)>>>9)<<4)+14]=S;var W=1732584193;var V=-271733879;var U=-1732584194;var T=271733878;for(var P=0;P<X.length;P+=16){var R=W;var Q=V;var O=U;var N=T;W=G(W,V,U,T,X[P+0],7,-680876936);T=G(T,W,V,U,X[P+1],12,-389564586);U=G(U,T,W,V,X[P+2],17,606105819);V=G(V,U,T,W,X[P+3],22,-1044525330);W=G(W,V,U,T,X[P+4],7,-176418897);T=G(T,W,V,U,X[P+5],12,1200080426);U=G(U,T,W,V,X[P+6],17,-1473231341);V=G(V,U,T,W,X[P+7],22,-45705983);W=G(W,V,U,T,X[P+8],7,1770035416);T=G(T,W,V,U,X[P+9],12,-1958414417);U=G(U,T,W,V,X[P+10],17,-42063);V=G(V,U,T,W,X[P+11],22,-1990404162);W=G(W,V,U,T,X[P+12],7,1804603682);T=G(T,W,V,U,X[P+13],12,-40341101);U=G(U,T,W,V,X[P+14],17,-1502002290);V=G(V,U,T,W,X[P+15],22,1236535329);W=C(W,V,U,T,X[P+1],5,-165796510);T=C(T,W,V,U,X[P+6],9,-1069501632);U=C(U,T,W,V,X[P+11],14,643717713);V=C(V,U,T,W,X[P+0],20,-373897302);W=C(W,V,U,T,X[P+5],5,-701558691);T=C(T,W,V,U,X[P+10],9,38016083);U=C(U,T,W,V,X[P+15],14,-660478335);V=C(V,U,T,W,X[P+4],20,-405537848);W=C(W,V,U,T,X[P+9],5,568446438);T=C(T,W,V,U,X[P+14],9,-1019803690);U=C(U,T,W,V,X[P+3],14,-187363961);V=C(V,U,T,W,X[P+8],20,1163531501);W=C(W,V,U,T,X[P+13],5,-1444681467);T=C(T,W,V,U,X[P+2],9,-51403784);U=C(U,T,W,V,X[P+7],14,1735328473);V=C(V,U,T,W,X[P+12],20,-1926607734);W=I(W,V,U,T,X[P+5],4,-378558);T=I(T,W,V,U,X[P+8],11,-2022574463);U=I(U,T,W,V,X[P+11],16,1839030562);V=I(V,U,T,W,X[P+14],23,-35309556);W=I(W,V,U,T,X[P+1],4,-1530992060);T=I(T,W,V,U,X[P+4],11,1272893353);U=I(U,T,W,V,X[P+7],16,-155497632);V=I(V,U,T,W,X[P+10],23,-1094730640);W=I(W,V,U,T,X[P+13],4,681279174);T=I(T,W,V,U,X[P+0],11,-358537222);U=I(U,T,W,V,X[P+3],16,-722521979);V=I(V,U,T,W,X[P+6],23,76029189);W=I(W,V,U,T,X[P+9],4,-640364487);T=I(T,W,V,U,X[P+12],11,-421815835);U=I(U,T,W,V,X[P+15],16,530742520);V=I(V,U,T,W,X[P+2],23,-995338651);W=E(W,V,U,T,X[P+0],6,-198630844);T=E(T,W,V,U,X[P+7],10,1126891415);U=E(U,T,W,V,X[P+14],15,-1416354905);V=E(V,U,T,W,X[P+5],21,-57434055);W=E(W,V,U,T,X[P+12],6,1700485571);T=E(T,W,V,U,X[P+3],10,-1894986606);U=E(U,T,W,V,X[P+10],15,-1051523);V=E(V,U,T,W,X[P+1],21,-2054922799);W=E(W,V,U,T,X[P+8],6,1873313359);T=E(T,W,V,U,X[P+15],10,-30611744);U=E(U,T,W,V,X[P+6],15,-1560198380);V=E(V,U,T,W,X[P+13],21,1309151649);W=E(W,V,U,T,X[P+4],6,-145523070);T=E(T,W,V,U,X[P+11],10,-1120210379);U=E(U,T,W,V,X[P+2],15,718787259);V=E(V,U,T,W,X[P+9],21,-343485551);W=F(W,R);V=F(V,Q);U=F(U,O);T=F(T,N)}return[W,V,U,T]}function A(Q){var P=[];var N=(1<<H)-1;for(var O=0;O<Q.length*H;O+=H){P[O>>5]|=(Q.charCodeAt(O/H)&N)<<(O%32)}return P}function L(P){var O=K?"0123456789ABCDEF":"0123456789abcdef";var Q="";for(var N=0;N<P.length*4;N++){Q+=O.charAt((P[N>>2]>>((N%4)*8+4))&15)+O.charAt((P[N>>2]>>((N%4)*8))&15)}return Q}return L(D(A(M),M.length*H))}}});